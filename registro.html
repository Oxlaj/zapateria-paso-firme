<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registro | Calzado Oxlaj</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./assets/css/styles.css" />
  <style>
    body{font-family:Poppins,system-ui,Segoe UI,Arial,sans-serif;background:#0D1B2A;color:#0f172a;margin:0;}
    .wrap{max-width:520px;margin:48px auto;padding:20px}
    .card{background:#fff;border-radius:14px;border:1px solid #e5e7eb;padding:22px;box-shadow:0 8px 24px -12px rgba(0,0,0,.25)}
    .title{margin:0 0 12px;font-weight:700}
    .muted{color:#64748b;font-size:.9rem;margin:0 0 12px}
    .field{display:grid;gap:.35rem;margin-bottom:.85rem}
    .field input{padding:.6rem .75rem;border:1.5px solid #cbd5e1;border-radius:8px;font-size:.95rem}
    .actions{display:flex;gap:.75rem;flex-wrap:wrap;margin-top:.5rem}
    .btn{cursor:pointer;display:inline-flex;align-items:center;justify-content:center;padding:.65rem 1rem;border-radius:10px;font-weight:600;border:1px solid #0D1B2A}
    .btn--primary{background:#0D1B2A;color:#fff}
    .btn--outline{background:#fff;color:#0D1B2A}
    .error{color:#b42318;min-height:1.1em;font-size:.85rem}
    .ok{color:#166534;min-height:1.1em;font-size:.85rem}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1 class="title">Crear cuenta</h1>
      <p class="muted">Regístrate como cliente para poder comprar.</p>
      <form id="registerForm" novalidate>
        <label class="field">Nombre de usuario
          <input id="regNombre" type="text" required placeholder="Tu nombre" />
        </label>
        <label class="field">Correo
          <input id="regCorreo" type="email" required placeholder="tucorreo@ejemplo.com" />
        </label>
        <label class="field">Contraseña
          <input id="regPassword" type="password" required minlength="6" placeholder="Mínimo 6 caracteres" />
        </label>
        <div class="error" id="regError"></div>
        <div class="ok" id="regOk"></div>
        <div class="actions">
          <button type="submit" class="btn btn--primary">Crear cuenta</button>
          <a class="btn btn--outline" href="index.html?login=1">Volver al login</a>
        </div>
      </form>
    </div>
  </div>
  <script>
    const form = document.getElementById('registerForm');
    const err = document.getElementById('regError');
    const ok = document.getElementById('regOk');
    async function serverJSON(url, options={}){
      const opt = { headers: { 'Content-Type':'application/json' }, credentials:'include', ...options};
      if (opt.body && typeof opt.body !== 'string') opt.body = JSON.stringify(opt.body);
      const res = await fetch(url, opt);
      let data = null; try { data = await res.json(); } catch{}
      if(!res.ok){ const msg = (data && (data.error||data.detalle)) || ('Error '+res.status); const e = new Error(msg); e._data=data; throw e; }
      return data;
    }
    form.addEventListener('submit', async (e)=>{
      e.preventDefault(); err.textContent=''; ok.textContent='';
      const nombre = document.getElementById('regNombre').value.trim();
      const correo = document.getElementById('regCorreo').value.trim();
      const password = document.getElementById('regPassword').value;
      if(!nombre || !correo || !password){ err.textContent='Completa todos los campos'; return; }
      if(password.length < 6){ err.textContent='La contraseña debe tener al menos 6 caracteres'; return; }
      try {
        const resp = await serverJSON('api/register.php',{ method:'POST', body:{ nombre, correo, password } });
        ok.textContent = 'Cuenta creada. Redirigiendo al login...';
        setTimeout(()=>{ window.location.href = 'index.html?login=1'; }, 1200);
      } catch(ex){ err.textContent = ex._data?.error || ex.message || 'Error registrando'; }
    });
  </script>
</body>
</html>
